<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Matches</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #000000;
            --black-2: #090000;
            --broom: #fff212;
            --ecstasy: #f97316;
            --eerie-black: #1d1d1d;
            --licorice: #191616;
            --white: #ffffff;
            --woodsmoke: #100a10;
            --sepia-black: #2c0000;
            --accent-green: #6df24b;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(0deg, rgba(9, 0, 0, 1) 81%, rgb(0, 0, 0) 100%);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            margin: 0;
            max-width: 430px;
            margin: 0 auto;
            position: relative;
        }

        html {
            overflow-x: hidden;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            max-width: 430px;
            margin: 0 auto;
            height: 98px;
            z-index: 100;
            background: linear-gradient(180deg, rgba(111, 0, 0, 1) 0%, rgba(9, 0, 0, 1) 100%);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 32px 30px;
        }

        .menu-icon,
        .search-icon {
            width: 35px;
            height: 35px;
            cursor: pointer;
            transition: transform 0.2s;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .menu-icon:hover,
        .search-icon:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.15);
        }

        .logo {
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--white);
        }

        .main-content {
            margin-top: 98px;
            margin-bottom: 0;
            padding: 20px 15px 80px;
            height: calc(100vh - 98px);
            overflow-y: scroll;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .main-content::-webkit-scrollbar {
            display: none;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        /* Featured Match Card */
        .featured-match {
            background: var(--woodsmoke);
            border-radius: 12px;
            padding: 0;
            margin-bottom: 30px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
        }

        .featured-match:hover {
            transform: translateY(-3px);
        }

        .featured-header {
            padding: 12px 15px;
            background: var(--ecstasy);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .live-text {
            font-size: 11px;
            font-weight: 700;
            color: white;
        }

        .featured-content {
            padding: 20px 15px;
            text-align: center;
        }

        .play-icon {
            width: 70px;
            height: 70px;
            margin: 0 auto 15px;
            font-size: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
        }

        .watch-now {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--white);
        }

        .featured-teams {
            background: var(--sepia-black);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .featured-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .featured-logo {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
        }

        .featured-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .featured-name {
            font-size: 10px;
            font-weight: 700;
        }

        .featured-score {
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* All Live Matches */
        .all-live-section {
            margin-top: 30px;
        }

        .match-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .match-item {
            background: var(--eerie-black);
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .match-item:hover {
            background: #252525;
        }

        .match-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .match-league-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .league-badge {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .league-badge img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .league-badge span {
            font-size: 14px;
        }

        .league-info-text {
            font-size: 13px;
            font-weight: 700;
        }

        .match-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .match-count {
            background: var(--broom);
            color: var(--black);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
        }

        .expand-icon {
            font-size: 10px;
            transition: transform 0.3s;
            color: var(--white);
        }

        .match-item.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .match-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .match-item.expanded .match-details {
            max-height: 800px;
            margin-top: 15px;
        }

        .detail-match {
            padding: 15px 12px;
            background: #2a2a2a;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            position: relative;
        }

        .detail-match:last-child {
            margin-bottom: 0;
        }

        .match-team-section {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .team-logo-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .team-logo-circle img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .team-name-detail {
            font-size: 12px;
            font-weight: 600;
            color: var(--white);
        }

        .match-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            min-width: 80px;
        }

        .match-score {
            font-size: 20px;
            font-weight: 700;
            color: var(--white);
            letter-spacing: 3px;
        }

        .match-status {
            font-size: 11px;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 8px;
            color: var(--white);
            background: #ff0000;
            animation: pulse 2s infinite;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: #ff0000;
            border-radius: 50%;
            animation: pulse 2s infinite;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Loading Styles */
        .loading {
            text-align: center;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--accent-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 12px;
            color: #888;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .no-live-matches {
            text-align: center;
            padding: 40px 20px;
            background: var(--eerie-black);
            border-radius: 10px;
        }

        .no-live-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .no-live-text {
            font-size: 14px;
            color: #888;
        }

        .bottom-nav a {
            text-decoration: none;
            color: inherit;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 430px;
            margin: 0 auto;
            height: 70px;
            background: var(--licorice);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding: 0 10px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 8px 12px;
        }

        .nav-item:hover {
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 18px;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-label {
            font-size: 9px;
            font-weight: 400;
            color: var(--white);
        }

        .nav-item.active .nav-label {
            color: var(--broom);
            font-weight: 700;
        }

        @media (min-width: 431px) {
            body {
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="menu-icon" onclick="alert('Menu')">‚ò∞</div>
            <div class="logo">LIVESCORE</div>
            <div class="search-icon" onclick="alert('Search')">üîç</div>
        </div>
    </header>

    <main class="main-content">
        <div class="section-title">Featured Match</div>
        <div id="featuredMatchContainer">
            <div class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Loading featured match...</div>
            </div>
        </div>

        <div class="all-live-section">
            <div class="section-title">All Live Matches</div>
            <div class="match-list" id="liveMatchList">
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">Loading live matches...</div>
                </div>
            </div>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="../index.html" class="nav-item">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Home</div>
        </a>
        <a href="bottom-live.html" class="nav-item active">
            <div class="nav-icon">üì°</div>
            <div class="nav-label">Live</div>
        </a>
        <a href="../bottom-league/league.html" class="nav-item">
            <div class="nav-icon">üèÜ</div>
            <div class="nav-label">League</div>
        </a>
        <a href="../bottom-more.html" class="nav-item">
            <div class="nav-icon">‚ãØ</div>
            <div class="nav-label">More</div>
        </a>
    </nav>

    <script>
        // API Configuration
        const API_BASE = 'https://www.fotmob.com/api/data';
        const TOP_LEAGUE_IDS = [47, 87, 55, 54, 53, 130, 102]; // EPL, La Liga, Serie A, Bundesliga, Ligue 1, Liga 1 Indonesia, Champions League

        let liveMatchesData = [];
        let updateInterval = null;
        let isLoading = false;

        // Utility functions
        function isImageUrl(str) {
            return str && (str.startsWith('http') || str.startsWith('data:image'));
        }

        function renderIcon(icon, fallback = '‚öΩ') {
            if (isImageUrl(icon)) {
                return `<img src="${icon}" alt="logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`;
            }
            return icon || fallback;
        }

        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        function getLeagueImageUrl(leagueId) {
            return `https://images.fotmob.com/image_resources/logo/leaguelogo/${leagueId}.png`;
        }

        function getTeamImageUrl(teamId) {
            return `https://images.fotmob.com/image_resources/logo/teamlogo/${teamId}.png`;
        }

        function formatTime(timeStr) {
            if (!timeStr) return '';
            const parts = timeStr.split(' ');
            return parts.length > 1 ? parts[1] : timeStr;
        }

        function getMatchStatus(match) {
            const status = match.status;
            if (status.started && !status.finished) {
                return {
                    text: status.liveTime?.short || match.time || 'LIVE',
                    class: 'status-live',
                    isLive: true,
                    minute: status.liveTime?.short || match.time || ''
                };
            } else if (status.finished) {
                return { text: 'FT', class: 'status-ft', isLive: false, minute: '' };
            } else {
                return {
                    text: formatTime(match.time),
                    class: 'status-upcoming',
                    isLive: false,
                    minute: ''
                };
            }
        }

        // Fetch live matches from API
        async function fetchLiveMatches() {
            if (isLoading) return;

            try {
                isLoading = true;
                const dateStr = getTodayDate();

                const response = await fetch(`${API_BASE}/matches?date=${dateStr}&timezone=Asia%2FBangkok&ccode3=IDN`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.leagues) {
                    // Filter only live matches (started but not finished)
                    const liveLeagues = data.leagues.map(league => {
                        if (!league.matches) return null;

                        const liveMatches = league.matches.filter(match =>
                            match.status?.started && !match.status?.finished
                        );

                        if (liveMatches.length === 0) return null;

                        return {
                            ...league,
                            matches: liveMatches
                        };
                    }).filter(league => league !== null);

                    liveMatchesData = liveLeagues;
                    return liveLeagues;
                } else {
                    return [];
                }
            } catch (error) {
                console.error('Error loading live matches:', error);
                return [];
            } finally {
                isLoading = false;
            }
        }

        // Select featured match (most important live match)
        function selectFeaturedMatch(leagues) {
            if (!leagues || leagues.length === 0) return null;

            // Priority: Top leagues first
            for (const league of leagues) {
                if (TOP_LEAGUE_IDS.includes(parseInt(league.id)) && league.matches && league.matches.length > 0) {
                    return {
                        match: league.matches[0],
                        leagueName: league.name,
                        leagueId: league.id
                    };
                }
            }

            // If no top league matches, return first available live match
            for (const league of leagues) {
                if (league.matches && league.matches.length > 0) {
                    return {
                        match: league.matches[0],
                        leagueName: league.name,
                        leagueId: league.id
                    };
                }
            }

            return null;
        }

        // Render featured match
        function renderFeaturedMatch(featuredData) {
            const container = document.getElementById('featuredMatchContainer');

            if (!featuredData) {
                container.innerHTML = `
                    <div class="no-live-matches">
                        <div class="no-live-icon">üì∫</div>
                        <div class="no-live-text">No featured live match available</div>
                    </div>
                `;
                return;
            }

            const { match, leagueName, leagueId } = featuredData;
            const status = getMatchStatus(match);

            container.innerHTML = `
                <div class="featured-match" onclick="viewMatchDetail('${match.id}')">
                    <div class="featured-header">
                        <div class="live-dot"></div>
                        <div class="live-text">LIVE ${status.minute}</div>
                    </div>
                    <div class="featured-content">
                        <div class="play-icon">‚ñ∂Ô∏è</div>
                        <div class="watch-now">Watch Live Now</div>
                    </div>
                    <div class="featured-teams">
                        <div class="featured-team">
                            <div class="featured-logo">
                                ${renderIcon(getTeamImageUrl(match.home.id), 'üî¥')}
                            </div>
                            <div class="featured-name">${match.home.name}</div>
                        </div>
                        <div class="featured-score">
                            ${match.home.score !== undefined ? match.home.score : '0'} - ${match.away.score !== undefined ? match.away.score : '0'}
                        </div>
                        <div class="featured-team">
                            <div class="featured-logo">
                                ${renderIcon(getTeamImageUrl(match.away.id), 'üîµ')}
                            </div>
                            <div class="featured-name">${match.away.name}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Render all live matches
        function renderLiveMatches(leagues) {
            const container = document.getElementById('liveMatchList');

            if (!leagues || leagues.length === 0) {
                container.innerHTML = `
                    <div class="no-live-matches">
                        <div class="no-live-icon">‚öΩ</div>
                        <div class="no-live-text">No live matches at the moment</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = leagues.map((league, index) => {
                if (!league.matches || league.matches.length === 0) return '';

                return `
                    <div class="match-item" id="live-${index}">
                        <div class="match-item-header" onclick="toggleMatchDetails(${index})">
                            <div class="match-league-info">
                                <div class="league-badge">
                                    ${renderIcon(getLeagueImageUrl(league.id), 'üèÜ')}
                                </div>
                                <div class="league-info-text">${league.name}</div>
                            </div>
                            <div class="match-actions">
                                <div class="match-count">${league.matches.length}</div>
                                <div class="expand-icon">‚ñº</div>
                            </div>
                        </div>
                        <div class="match-details">
                            ${league.matches.map(match => {
                    const status = getMatchStatus(match);
                    return `
                                    <div class="detail-match" onclick="viewMatchDetail('${match.id}')" style="position: relative;">
                                        <div class="match-team-section">
                                            <div class="team-logo-circle">
                                                ${renderIcon(getTeamImageUrl(match.home.id), 'üî¥')}
                                            </div>
                                            <div class="team-name-detail">${match.home.name}</div>
                                        </div>
                                        <div class="match-center">
                                            <div class="match-score">${match.home.score !== undefined ? match.home.score : '0'} - ${match.away.score !== undefined ? match.away.score : '0'}</div>
                                            <div class="match-status">${status.text}</div>
                                        </div>
                                        <div class="match-team-section" style="flex-direction: row-reverse;">
                                            <div class="team-logo-circle">
                                                ${renderIcon(getTeamImageUrl(match.away.id), 'üîµ')}
                                            </div>
                                            <div class="team-name-detail" style="text-align: right;">${match.away.name}</div>
                                        </div>
                                        ${status.isLive ? '<div class="live-indicator"></div>' : ''}
                                    </div>
                                `;
                }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle match details
        function toggleMatchDetails(index) {
            const element = document.getElementById(`live-${index}`);
            element.classList.toggle('expanded');
        }

        // Replace the existing viewMatchDetail function with this:
function viewMatchDetail(matchId) {
    // Get the match data from our current live matches
    let matchData = null;
    let leagueId = '';
    let leagueName = '';
    
    // Search for the match in our current live matches data
    for (const league of liveMatchesData) {
        const match = league.matches?.find(m => m.id === matchId);
        if (match) {
            matchData = match;
            leagueId = league.id;
            leagueName = league.name;
            break;
        }
    }
    
    // If match found, redirect to detail page
    if (matchData) {
        // Encode data to pass via URL
        const encodedData = encodeURIComponent(JSON.stringify({
            matchId: matchId,
            homeTeam: {
                id: matchData.home.id,
                name: matchData.home.name,
                score: matchData.home.score || 0
            },
            awayTeam: {
                id: matchData.away.id,
                name: matchData.away.name,
                score: matchData.away.score || 0
            },
            league: {
                id: leagueId,
                name: leagueName
            },
            status: matchData.status,
            time: matchData.time
        }));
        
        // Redirect to match detail page
        window.location.href = `live-detail.html?data=${encodedData}`;
    } else {
        // If match not in our current data, still try to load from API
        window.location.href = `live-detail.html?matchId=${matchId}`;
    }
}

// Also update the renderMatchCard function to use match.id properly:
function renderMatchCard(match, index) {
    const status = getMatchStatus(match);
    const homeScore = match.home.score !== undefined ? match.home.score : '0';
    const awayScore = match.away.score !== undefined ? match.away.score : '0';
    
    return `
        <div class="detail-match" onclick="viewMatchDetail('${match.id}')">
            <div class="match-team-section">
                <div class="team-logo-circle">
                    ${renderIcon(getTeamImageUrl(match.home.id), 'üî¥')}
                </div>
                <div class="team-name-detail">${match.home.name}</div>
            </div>
            <div class="match-center">
                <div class="match-score">${status.isLive || status.text === 'FT' ? homeScore + ' - ' + awayScore : status.text}</div>
                <div class="match-status ${status.class}">${status.text}</div>
            </div>
            <div class="match-team-section" style="flex-direction: row-reverse;">
                <div class="team-logo-circle">
                    ${renderIcon(getTeamImageUrl(match.away.id), 'üîµ')}
                </div>
                <div class="team-name-detail" style="text-align: right;">${match.away.name}</div>
            </div>
            ${status.isLive ? '<div class="live-indicator"></div>' : ''}
        </div>
    `;
}

// Update renderFeaturedMatch to pass correct match ID:
function renderFeaturedMatch(featuredData) {
    const container = document.getElementById('featuredMatchContainer');
    
    if (!featuredData) {
        container.innerHTML = `
            <div class="no-live-matches">
                <div class="no-live-icon">üì∫</div>
                <div class="no-live-text">No featured live match available</div>
            </div>
        `;
        return;
    }
    
    const { match, leagueName, leagueId } = featuredData;
    const status = getMatchStatus(match);
    
    container.innerHTML = `
        <div class="featured-match" onclick="viewMatchDetail('${match.id}')">
            <div class="featured-header">
                <div class="live-dot"></div>
                <div class="live-text">LIVE ${status.minute}</div>
            </div>
            <div class="featured-content">
                <div class="play-icon">‚ñ∂Ô∏è</div>
                <div class="watch-now">Watch Live Now</div>
            </div>
            <div class="featured-teams">
                <div class="featured-team">
                    <div class="featured-logo">
                        ${renderIcon(getTeamImageUrl(match.home.id), 'üî¥')}
                    </div>
                    <div class="featured-name">${match.home.name}</div>
                </div>
                <div class="featured-score">
                    ${match.home.score !== undefined ? match.home.score : '0'} - ${match.away.score !== undefined ? match.away.score : '0'}
                </div>
                <div class="featured-team">
                    <div class="featured-logo">
                        ${renderIcon(getTeamImageUrl(match.away.id), 'üîµ')}
                    </div>
                    <div class="featured-name">${match.away.name}</div>
                </div>
            </div>
        </div>
    `;
}
        // Load and render all live data
        async function loadLiveData() {
            try {
                const liveLeagues = await fetchLiveMatches();
                const featuredMatch = selectFeaturedMatch(liveLeagues);

                renderFeaturedMatch(featuredMatch);
                renderLiveMatches(liveLeagues);
            } catch (error) {
                console.error('Error loading live data:', error);
            }
        }

        // Initialize
        async function init() {
            await loadLiveData();

            // Auto-refresh every 15 seconds for live matches
            if (updateInterval) clearInterval(updateInterval);
            updateInterval = setInterval(loadLiveData, 15000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', init);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) clearInterval(updateInterval);
        });
    </script>
</body>

</html>