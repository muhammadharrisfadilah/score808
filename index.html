<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Live Score</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --black: #000000;
            --black-2: #090000;
            --broom: #fff212;
            --ecstasy: #f97316;
            --eerie-black: #1d1d1d;
            --licorice: #191616;
            --white: #ffffff;
            --accent-green: #6df24b;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(0deg, rgba(9, 0, 0, 1) 81%, rgba(111, 0, 0, 1) 100%);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
            margin: 0;
            max-width: 430px;
            margin: 0 auto;
            position: relative;
        }

        html {
            overflow-x: hidden;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 76px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 28px 30px;
            z-index: 100;
            background: transparent;
            max-width: 430px;
            margin: 0 auto;
        }

        .menu-icon, .search-icon {
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: transform 0.2s;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .menu-icon:hover, .search-icon:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.15);
        }

        .logo {
            font-size: 10px;
            font-weight: 70;
            letter-spacing: 3px;
            color: var(--white);
        }

        .main-content {
            margin-top: 70px;
            margin-bottom: 0;
            padding: 15px 0 80px 0;
            height: calc(100vh - 70px);
            overflow-y: scroll;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .main-content::-webkit-scrollbar {
            display: none;
            width: 0;
            height: 0;
        }

        .content-wrapper {
            padding: 0 13px;
        }

        .leagues-section {
            margin-bottom: 28px;
        }

        .leagues-carousel {
            display: flex;
            gap: 19px;
            overflow-x: scroll;
            overflow-y: hidden;
            padding: 10px 2px;
            scrollbar-width: none;
            -ms-overflow-style: none;
            -webkit-overflow-scrolling: touch;
            min-height: 110px;
        }

        .leagues-carousel::-webkit-scrollbar {
            display: none;
            width: 0;
            height: 0;
        }

        .league-item {
            flex-shrink: 0;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
        }

        .league-item:hover {
            transform: translateY(-5px);
        }

        .league-item.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background: var(--accent-green);
            border-radius: 2px;
        }

        .league-icon {
            width: 72px;
            height: 72px;
            border-radius: 36px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .league-icon img,
        .team-logo-circle img,
        .league-badge img,
        .upcoming-team-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .league-icon span,
        .team-logo-circle span,
        .league-badge span,
        .upcoming-team-logo span {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .league-name {
            font-size: 14px;
            font-weight: 700;
            max-width: 72px;
            line-height: 1.2;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 700;
        }

        .see-all {
            color: var(--accent-green);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .see-all:hover {
            opacity: 0.8;
        }

        .hide-all-btn {
            background: var(--eerie-black);
            border: 1px solid #333;
            color: var(--white);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
            width: 100%;
            text-align: center;
        }

        .hide-all-btn:hover {
            background: #252525;
        }

        .upcoming-section {
            margin-bottom: 24px;
            min-height: 180px;
        }

        .matches-carousel {
            display: flex;
            gap: 15px;
            overflow-x: scroll;
            overflow-y: hidden;
            padding: 10px 0;
            margin-bottom: 20px;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            min-height: 160px;
        }

        .matches-carousel::-webkit-scrollbar {
            display: none;
            width: 0;
            height: 0;
        }

        .upcoming-card {
            flex-shrink: 0;
            width: 195px;
            background: var(--black);
            border: 1.5px solid #2a2a2a;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
        }

        .upcoming-card:hover {
            transform: translateY(-3px);
            border-color: #444;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .upcoming-date-time {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }

        .upcoming-date {
            font-size: 10px;
            font-weight: 400;
            color: #888;
        }

        .upcoming-time {
            font-size: 10px;
            font-weight: 700;
            color: var(--white);
        }

        .upcoming-match-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }

        .upcoming-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .upcoming-team-logo {
            width: 55px;
            height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 45px;
        }

        .upcoming-team-name {
            font-size: 11px;
            font-weight: 600;
            color: var(--white);
            text-align: center;
            line-height: 1.3;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .upcoming-vs {
            font-size: 13px;
            font-weight: 700;
            color: #555;
            padding: 0 4px;
            margin-top: 20px;
        }

        .todays-matches {
            margin-top: 24px;
            min-height: 200px;
        }

        .match-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .match-item {
            background: var(--eerie-black);
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .match-item:hover {
            background: #252525;
        }

        .match-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .match-league-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .league-badge {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .league-info-text {
            font-size: 13px;
            font-weight: 700;
        }

        .match-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .match-count {
            background: var(--broom);
            color: var(--black);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
        }

        .expand-icon {
            font-size: 10px;
            transition: transform 0.3s;
            color: var(--white);
        }

        .match-item.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .match-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .match-item.expanded .match-details {
            max-height: 800px;
            margin-top: 15px;
        }

        .detail-match {
            padding: 15px 12px;
            background: #2a2a2a;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            position: relative;
        }

        .detail-match:last-child {
            margin-bottom: 0;
        }

        .match-team-section {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .team-logo-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .team-name-detail {
            font-size: 12px;
            font-weight: 600;
            color: var(--white);
        }

        .match-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            min-width: 80px;
        }

        .match-score {
            font-size: 20px;
            font-weight: 700;
            color: var(--white);
            letter-spacing: 3px;
        }

        .match-status {
            font-size: 11px;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 8px;
        }

        .status-upcoming {
            color: var(--accent-green);
            background: transparent;
        }

        .status-live {
            color: var(--white);
            background: #ff0000;
            animation: pulse 2s infinite;
        }

        .status-ft {
            color: #888;
            background: transparent;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: #ff0000;
            border-radius: 50%;
            animation: pulse 2s infinite;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        .no-matches-card {
            background: var(--eerie-black);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
        }

        .no-matches-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .no-matches-text {
            font-size: 14px;
            color: #888;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: var(--licorice);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding: 0 20px;
            max-width: 430px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 10px 15px;
        }

        .nav-item:hover {
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 15px;
            width: 15px;
            height: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 400;
            color: var(--white);
        }

        .nav-item.active .nav-label {
            color: var(--broom);
            font-weight: 700;
        }

        .bottom-nav a {
            text-decoration: none;
            color: inherit;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--accent-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        .loading-text {
            font-size: 12px;
            color: #888;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .skeleton {
            background: linear-gradient(90deg, #1d1d1d 25%, #2a2a2a 50%, #1d1d1d 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-league {
            width: 72px;
            height: 72px;
            border-radius: 36px;
            margin-bottom: 10px;
        }

        .skeleton-card {
            width: 195px;
            height: 140px;
            border-radius: 12px;
        }

        .skeleton-match {
            height: 60px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        @media (max-width: 430px) {
            .header {
                padding: 20px 15px;
            }
            
            .content-wrapper {
                padding: 0 10px;
            }

            .upcoming-card {
                width: 185px;
            }
        }

        @media (min-width: 431px) {
            body {
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="menu-icon" onclick="alert('Menu')">‚ò∞</div>
        <div class="logo">LIVESCORE</div>
        <div class="search-icon" onclick="alert('Search')">üîç</div>
    </header>

    <main class="main-content">
        <div class="content-wrapper">
            <section class="leagues-section">
                <div class="leagues-carousel" id="leaguesCarousel">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Loading leagues...</div>
                    </div>
                </div>
            </section>

            <section class="upcoming-section">
                <div class="section-header">
                    <h2 class="section-title">Upcomings</h2>
                    <a href="#" class="see-all">See all ‚Üí</a>
                </div>
                <div class="matches-carousel" id="upcomingMatches">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Loading upcoming matches...</div>
                    </div>
                </div>
            </section>

            <section class="todays-matches">
                <div class="section-header">
                    <h2 class="section-title">Today's Matches</h2>
                </div>
                <div id="topLeaguesMatches">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div class="loading-text">Loading today's matches...</div>
                    </div>
                </div>
                <button class="hide-all-btn hidden" id="hideAllBtn" onclick="toggleOtherLeagues()">Show Other Leagues</button>
                <div class="match-list" id="otherLeaguesMatches"></div>
            </section>
        </div>
    </main>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">Home</div>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">üì°</div>
            <div class="nav-label">Live</div>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">üèÜ</div>
            <div class="nav-label">League</div>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">‚ãØ</div>
            <div class="nav-label">More</div>
        </a>
    </nav>

    <script>
        // API BASE sesuai permintaan, tidak dirubah
        const API_BASE = 'https://www.fotmob.com/api/data';
        
        let popularLeagues = [];
        let allLeaguesData = null;
        let allMatchesData = [];
        let selectedLeagueId = null;
        let otherLeaguesVisible = false;
        let isLoading = false;
        let updateInterval = null;

        // Top leagues including Indonesia Liga 1
        const TOP_LEAGUE_IDS = [47, 87, 55, 54, 53, 130, 102]; // EPL, La Liga, Serie A, Bundesliga, Ligue 1, Liga 1 Indonesia, Champions League

        const COUNTRY_FLAGS = {
            'ENG': 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø',
            'ESP': 'üá™üá∏',
            'ITA': 'üáÆüáπ',
            'GER': 'üá©üá™',
            'FRA': 'üá´üá∑',
            'IDN': 'üáÆüá©',
            'INT': 'üåç'
        };

        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        function getLeagueImageUrl(leagueId) {
            return `https://images.fotmob.com/image_resources/logo/leaguelogo/${leagueId}.png`;
        }

        function getTeamImageUrl(teamId) {
            return `https://images.fotmob.com/image_resources/logo/teamlogo/${teamId}.png`;
        }

        function formatTime(timeStr) {
            if (!timeStr) return '';
            const parts = timeStr.split(' ');
            return parts.length > 1 ? parts[1] : timeStr;
        }

        function formatDate(utcTime) {
            const date = new Date(utcTime);
            const options = { weekday: 'short', day: 'numeric', month: 'short' };
            return date.toLocaleDateString('en-US', options);
        }

        function getMatchStatus(match) {
            const status = match.status;
            if (status.started && !status.finished) {
                return { text: 'LIVE', class: 'status-live', isLive: true };
            } else if (status.finished) {
                return { text: 'FT', class: 'status-ft', isLive: false };
            } else {
                return { text: formatTime(match.time), class: 'status-upcoming', isLive: false };
            }
        }

        // Logic Fetch diperbaiki untuk menangani error tanpa merubah URL
        async function loadAllLeagues() {
            try {
                // Tambahan headers untuk memastikan request diterima dengan baik (best practice)
                const response = await fetch(`${API_BASE}/allLeagues?locale=en&ccode3=IDN`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                // Cek apakah response sukses (status 200-299)
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.popular) {
                    popularLeagues = data.popular;
                }
                
                allLeaguesData = data;
                return data;
            } catch (error) {
                console.error('Error loading all leagues:', error);
                // Kembalikan objek kosong atau null agar tidak mematikan fungsi pemanggil
                return null;
            }
        }

        async function renderTopLeagues() {
            const container = document.getElementById('leaguesCarousel');
            
            if (popularLeagues.length === 0) {
                await loadAllLeagues();
            }
            
            // Perbaikan: Cek jika popularLeagues masih kosong setelah loadAllLeagues
            if (!popularLeagues || popularLeagues.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 10px;">Gagal memuat liga</p>';
                return;
            }
            
            // Filter to show only top leagues
            const displayLeagues = popularLeagues.filter(league => 
                TOP_LEAGUE_IDS.includes(parseInt(league.id))
            ).slice(0, 8);
            
            if (displayLeagues.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center;">No leagues available</p>';
                return;
            }
            
            container.innerHTML = displayLeagues.map(league => `
                <div class="league-item ${selectedLeagueId === league.id ? 'active' : ''}" 
                     onclick="filterByLeague('${league.id}')" 
                     data-league-id="${league.id}">
                    <div class="league-icon">
                        <img src="${getLeagueImageUrl(league.id)}" 
                             alt="${league.name}"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <span style="display: none;">${COUNTRY_FLAGS[league.ccode] || 'üèÜ'}</span>
                    </div>
                    <div class="league-name">${league.name}</div>
                </div>
            `).join('');
        }

        function filterByLeague(leagueId) {
            if (selectedLeagueId === leagueId) {
                selectedLeagueId = null;
            } else {
                selectedLeagueId = leagueId;
            }
            
            document.querySelectorAll('.league-item').forEach(item => {
                item.classList.toggle('active', item.dataset.leagueId === selectedLeagueId);
            });
            
            renderTodayMatches(allMatchesData);
        }

        function renderUpcomingMatches(leagues) {
            const container = document.getElementById('upcomingMatches');
            let upcomingMatches = [];
            
            // Perbaikan: Cek apakah leagues ada sebelum melakukan forEach
            if (!leagues) {
                container.innerHTML = '<p style="color: #888; text-align: center;">No data</p>';
                return;
            }

            leagues.forEach(league => {
                if (league.matches) {
                    const upcoming = league.matches.filter(m => !m.status.started);
                    upcomingMatches = upcomingMatches.concat(upcoming.slice(0, 2).map(match => ({
                        ...match,
                        leagueName: league.name
                    })));
                }
            });

            if (upcomingMatches.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 40px 0;">No upcoming matches</p>';
                return;
            }

            container.innerHTML = upcomingMatches.slice(0, 5).map(match => `
                <div class="upcoming-card" onclick="viewMatch('${match.id}')">
                    <div class="upcoming-date-time">
                        <span class="upcoming-date">${formatDate(match.status.utcTime)}</span>
                        <span class="upcoming-time">${formatTime(match.time)}</span>
                    </div>
                    <div class="upcoming-match-content">
                        <div class="upcoming-team">
                            <div class="upcoming-team-logo">
                                <img src="${getTeamImageUrl(match.home.id)}" 
                                     alt="${match.home.name}"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <span style="display: none;">‚öΩ</span>
                            </div>
                            <div class="upcoming-team-name">${match.home.name}</div>
                        </div>
                        <div class="upcoming-vs">vs</div>
                        <div class="upcoming-team">
                            <div class="upcoming-team-logo">
                                <img src="${getTeamImageUrl(match.away.id)}" 
                                     alt="${match.away.name}"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <span style="display: none;">‚öΩ</span>
                            </div>
                            <div class="upcoming-team-name">${match.away.name}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderMatchCard(match, index) {
            const status = getMatchStatus(match);
            const homeScore = match.home.score !== undefined ? match.home.score : '-';
            const awayScore = match.away.score !== undefined ? match.away.score : '-';
            
            return `
                <div class="detail-match" onclick="viewMatch('${match.id}')">
                    <div class="match-team-section">
                        <div class="team-logo-circle">
                            <img src="${getTeamImageUrl(match.home.id)}" 
                                 alt="${match.home.name}"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <span style="display: none;">‚öΩ</span>
                        </div>
                        <div class="team-name-detail">${match.home.name}</div>
                    </div>
                    <div class="match-center">
                        <div class="match-score">${status.isLive || status.text === 'FT' ? homeScore + ' - ' + awayScore : status.text}</div>
                        <div class="match-status ${status.class}">${status.text}</div>
                    </div>
                    <div class="match-team-section" style="flex-direction: row-reverse;">
                        <div class="team-logo-circle">
                            <img src="${getTeamImageUrl(match.away.id)}" 
                                 alt="${match.away.name}"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <span style="display: none;">‚öΩ</span>
                        </div>
                        <div class="team-name-detail" style="text-align: right;">${match.away.name}</div>
                    </div>
                    ${status.isLive ? '<div class="live-indicator"></div>' : ''}
                </div>
            `;
        }

        function renderTodayMatches(leagues) {
            const topContainer = document.getElementById('topLeaguesMatches');
            const otherContainer = document.getElementById('otherLeaguesMatches');
            const hideBtn = document.getElementById('hideAllBtn');

            if (!leagues || leagues.length === 0) {
                topContainer.innerHTML = '<p style="color: #888; text-align: center; padding: 40px 0;">No matches today</p>';
                otherContainer.innerHTML = '';
                hideBtn.classList.add('hidden');
                return;
            }

            let filteredLeagues = leagues;
            if (selectedLeagueId) {
                filteredLeagues = leagues.filter(l => l.id == selectedLeagueId);
                
                if (filteredLeagues.length === 0 || !filteredLeagues[0].matches || filteredLeagues[0].matches.length === 0) {
                    topContainer.innerHTML = `
                        <div class="no-matches-card">
                            <div class="no-matches-icon">üìÖ</div>
                            <div class="no-matches-text">No matches today for this league</div>
                        </div>
                    `;
                    otherContainer.innerHTML = '';
                    hideBtn.classList.add('hidden');
                    return;
                }
            }

            const topLeagues = filteredLeagues.filter(l => TOP_LEAGUE_IDS.includes(parseInt(l.id)));
            const otherLeagues = filteredLeagues.filter(l => !TOP_LEAGUE_IDS.includes(parseInt(l.id)));

            topContainer.innerHTML = topLeagues.map((league, index) => {
                if (!league.matches || league.matches.length === 0) return '';
                return `
                    <div class="match-item" id="top-league-${index}">
                        <div class="match-item-header" onclick="toggleMatchDetails('top-league-${index}')">
                            <div class="match-league-info">
                                <div class="league-badge">
                                    <img src="${getLeagueImageUrl(league.id)}" 
                                         alt="${league.name}"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <span style="display: none;">üèÜ</span>
                                </div>
                                <div class="league-info-text">${league.name}</div>
                            </div>
                            <div class="match-actions">
                                <div class="match-count">${league.matches.length}</div>
                                <div class="expand-icon">‚ñº</div>
                            </div>
                        </div>
                        <div class="match-details">
                            ${league.matches.map(match => renderMatchCard(match)).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            if (otherLeagues.length > 0 && !selectedLeagueId) {
                hideBtn.classList.remove('hidden');
                otherContainer.innerHTML = otherLeagues.map((league, index) => {
                    if (!league.matches || league.matches.length === 0) return '';
                    return `
                        <div class="match-item" id="other-league-${index}">
                            <div class="match-item-header" onclick="toggleMatchDetails('other-league-${index}')">
                                <div class="match-league-info">
                                    <div class="league-badge">
                                        <img src="${getLeagueImageUrl(league.id)}" 
                                             alt="${league.name}"
                                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <span style="display: none;">üèÜ</span>
                                    </div>
                                    <div class="league-info-text">${league.name}</div>
                                </div>
                                <div class="match-actions">
                                    <div class="match-count">${league.matches.length}</div>
                                    <div class="expand-icon">‚ñº</div>
                                </div>
                            </div>
                            <div class="match-details">
                                ${league.matches.map(match => renderMatchCard(match)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
                
                if (!otherLeaguesVisible) {
                    otherContainer.classList.add('hidden');
                }
            } else {
                hideBtn.classList.add('hidden');
                otherContainer.innerHTML = '';
            }
        }

        function toggleOtherLeagues() {
            const otherContainer = document.getElementById('otherLeaguesMatches');
            const hideBtn = document.getElementById('hideAllBtn');
            
            otherLeaguesVisible = !otherLeaguesVisible;
            
            if (otherLeaguesVisible) {
                otherContainer.classList.remove('hidden');
                hideBtn.textContent = 'Hide Other Leagues';
            } else {
                otherContainer.classList.add('hidden');
                hideBtn.textContent = 'Show Other Leagues';
            }
        }

        async function loadMatches() {
            if (isLoading) return;
            
            try {
                isLoading = true;
                const dateStr = getTodayDate();
                
                // Menggunakan API_BASE yang diminta user dengan penanganan error yang lebih baik
                const response = await fetch(`${API_BASE}/matches?date=${dateStr}&timezone=Asia%2FBangkok&ccode3=IDN`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();

                if (data.leagues) {
                    allMatchesData = data.leagues;
                    
                    if (popularLeagues.length === 0) {
                        await renderTopLeagues();
                    }
                    
                    renderUpcomingMatches(data.leagues);
                    renderTodayMatches(data.leagues);
                } else {
                    document.getElementById('topLeaguesMatches').innerHTML = '<p style="color: #888; text-align: center; padding: 40px 0;">No matches available</p>';
                }
            } catch (error) {
                console.error('Error loading matches:', error);
                document.getElementById('topLeaguesMatches').innerHTML = '<p style="color: #888; text-align: center; padding: 40px 0;">Error loading matches. Please try again later.</p>';
            } finally {
                isLoading = false;
            }
        }

        function toggleMatchDetails(elementId) {
            const element = document.getElementById(elementId);
            element.classList.toggle('expanded');
        }

        function viewMatch(matchId) {
            alert(`View match details for ID: ${matchId}`);
        }

        async function init() {
            await loadMatches();
            
            // Auto-refresh every 30 seconds
            if (updateInterval) clearInterval(updateInterval);
            updateInterval = setInterval(loadMatches, 30000);
        }

        window.addEventListener('DOMContentLoaded', init);
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) clearInterval(updateInterval);
        });
    </script>
</body>
</html>